<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>coqrel.Monotonicity</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library coqrel.Monotonicity</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="coqrel.RelDefinitions.html#"><span class="id" title="library">RelDefinitions</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="coqrel.RelOperators.html#"><span class="id" title="library">RelOperators</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <a class="idref" href="coqrel.Relators.html#"><span class="id" title="library">Relators</span></a>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="coqrel.Delay.html#"><span class="id" title="library">Delay</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab50"></a><h2 class="section">The <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span> tactic</h2>

<div class="paragraph"> </div>

 The purpose of the <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span> tactic is to automatically
  select and apply a theorem of the form <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Monotonic"><span class="id" title="abbreviation">Monotonic</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#m"><span class="id" title="variable">m</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#R"><span class="id" title="variable">R</span></a></span> in order to
  make progress when the goal is an applied relation. Compared with
  setoid rewriting, <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span> is less powerful, but more direct
  and simple. This means it is easier to debug, and it can seamlessly
  handle dependent types and heterogenous relations.

<div class="paragraph"> </div>

  The <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span> tactic applies to a goal of the form
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R"><span class="id" title="variable">R</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x1"><span class="id" title="variable">x1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x2"><span class="id" title="variable">x2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">xn</span>)</span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#y1"><span class="id" title="variable">y1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#y2"><span class="id" title="variable">y2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">yn</span>)</span>. The basic idea is to first
  locate a relational property declared by the user relating <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> and
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span>, namely an instance of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="record">Related</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelOperators.html#R'"><span class="id" title="variable">R'</span></a></span>, then to locate and
  instance of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="record">RElim</span></a></span> which will allow us to use <span class="inlinecode"><a class="idref" href="coqrel.RelOperators.html#R'"><span class="id" title="variable">R'</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> to make
  progress on the current goal. Most of the time, <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> and <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> will be
  identical so that the corresponding relational property can be
  writted <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Monotonic"><span class="id" title="abbreviation">Monotonic</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelOperators.html#R'"><span class="id" title="variable">R'</span></a></span>.

<div class="paragraph"> </div>

  For instance, we can register the monotonicity of <span class="inlinecode"><span class="id" title="var">plus</span></span> as an
  instance of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Monotonic"><span class="id" title="abbreviation">Monotonic</span></a></span> <span class="inlinecode"><span class="id" title="var">plus</span></span> <span class="inlinecode">(<span class="id" title="var">lt</span></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><span class="id" title="var">lt</span></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><span class="id" title="var">lt</span>)</span>. Given an goal of
  the form <span class="inlinecode"><span class="id" title="var">plus</span></span> <span class="inlinecode">5</span> <span class="inlinecode">6</span> <span class="inlinecode">&lt;</span> <span class="inlinecode"><span class="id" title="var">plus</span></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x"><span class="id" title="variable">x</span></a></span> <span class="inlinecode">5</span>, the monotonicity tactic will use
  that property and, using the <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="record">RElim</span></a></span> rule for <span class="inlinecode">++&gt;</span>, construct an
  instance of
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="record">RElim</span></a></span> <span class="inlinecode">(<span class="id" title="var">lt</span></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><span class="id" title="var">lt</span></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><span class="id" title="var">lt</span>)</span> <span class="inlinecode"><span class="id" title="var">plus</span></span> <span class="inlinecode"><span class="id" title="var">plus</span></span> <span class="inlinecode">(<span class="id" title="var">lt</span></span> <span class="inlinecode">5</span> <span class="inlinecode">7</span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">lt</span></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x"><span class="id" title="variable">x</span></a></span> <span class="inlinecode">5</span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">lt</span></span> <span class="inlinecode">(<span class="id" title="var">plus</span></span> <span class="inlinecode">5</span> <span class="inlinecode">6)</span> <span class="inlinecode">(<span class="id" title="var">plus</span></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x"><span class="id" title="variable">x</span></a></span> <span class="inlinecode">5))</span>
  to apply on the goal, leaving us with the subgoals <span class="inlinecode">5</span> <span class="inlinecode">&lt;</span> <span class="inlinecode">7</span> and
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x"><span class="id" title="variable">x</span></a></span> <span class="inlinecode">&lt;</span> <span class="inlinecode">5</span>.

<div class="paragraph"> </div>

  While this basic principle is rather straightforward, there are some
  subtleties that we have to consider in order to build a reliable
  system: the relational property we need to use may be about a prefix
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x1"><span class="id" title="variable">x1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x2"><span class="id" title="variable">x2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">xk</span></span> (<span class="inlinecode"><a class="idref" href="coqrel.KLR.html#k"><span class="id" title="definition">k</span></a></span> &lt; <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span>) of the application that still has some
  arguments applied; we want to be able to exploit <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span>
  relationships to extend the applicability of the declared relational
  properties; we need to be need to be careful about how we treat
  existential variables. 
<div class="paragraph"> </div>

<a name="lab51"></a><h3 class="section">Truncating applications</h3>

<div class="paragraph"> </div>

 The first complication arises from the fact that <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> and <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> may
  themselves be partial applications, so the goal may in fact be of
  the form
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R"><span class="id" title="variable">R</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#a1"><span class="id" title="variable">a1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#a2"><span class="id" title="variable">a2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">ak</span></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x1"><span class="id" title="variable">x1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x2"><span class="id" title="variable">x2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">xn</span>)</span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#b1"><span class="id" title="variable">b1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#b2"><span class="id" title="variable">b2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">bl</span></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#y1"><span class="id" title="variable">y1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#y2"><span class="id" title="variable">y2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">yn</span>)</span>,
  with <span class="inlinecode"><a class="idref" href="coqrel.KLR.html#k"><span class="id" title="definition">k</span></a></span> ≠ <span class="inlinecode"><a class="idref" href="coqrel.KLR.html#l"><span class="id" title="variable">l</span></a></span>, where the relational property to apply will be of
  the form <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="record">Related</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelOperators.html#R'"><span class="id" title="variable">R'</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#a1"><span class="id" title="variable">a1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#a2"><span class="id" title="variable">a2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">ak</span>)</span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#b1"><span class="id" title="variable">b1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#b2"><span class="id" title="variable">b2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">bl</span>)</span>. This is
  particularly relevant when <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> and <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> may have implicit typeclass
  arguments, or type arguments that cannot be covered by our dependent
  relators without causing universe inconsistency issues.

<div class="paragraph"> </div>

  Finding the head terms <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> and <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span>, then locating a property
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="record">Related</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelOperators.html#R'"><span class="id" title="variable">R'</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> is rather straightforward, however in this case we
  must only drop the last <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span> arguments from the applications before
  we look up the <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="record">Related</span></a></span> instance, with no way of guessing the
  correct value of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span>. We want to avoid having to peel off arguments
  one by one and performing a <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="record">Related</span></a></span> search at each step, so we ask
  the user to pitch in and declare instances of <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span> and
  <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span> to guide our search when partial applications with
  heads <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> and <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> are involved.

<div class="paragraph"> </div>

  Note that the term in the goal itself may only be partially
  applied. Suppose <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x1"><span class="id" title="variable">x1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x2"><span class="id" title="variable">x2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">xn</span></span> is in expecting <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#p"><span class="id" title="variable">p</span></a></span> more
  arguments, and that we find an instance of <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><span class="id" title="var">q</span></span>; then we
  should only drop <span class="inlinecode"><span class="id" title="var">q</span></span> <span class="inlinecode">-</span> <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#p"><span class="id" title="variable">p</span></a></span> arguments to obtain the prefix
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x1"><span class="id" title="variable">x1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x2"><span class="id" title="variable">x2</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">x_</span>(<a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a>+<a class="idref" href="coqrel.Monotonicity.html#p"><span class="id" title="variable">p</span></a>-<span class="id" title="var">q</span>)</span>.

<div class="paragraph"> </div>

  The class <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#QueryParams"><span class="id" title="record">QueryParams</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span> asserts that the head terms of <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a></span>
  and <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a></span> have <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a></span> declarations that instruct us to remove <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span>
  arguments from each of them before looking up a corresponding
  relational property. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="QueryParams"><span class="id" title="record">QueryParams</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">m1</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">m2</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">n</span>: <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>).<br/>

<br/>
</div>

<div class="doc">
If the head term on either side is an existential variable, we
  only check <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a></span> declarations for the other side. This auxiliary
  lemma is used to trigger this step; <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#p"><span class="id" title="variable">p</span></a></span> should be the number of
  unapplied arguments in whichever term <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a></span> of <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a></span> we extracted the
  non-existential head term <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#h"><span class="id" title="variable">h</span></a></span> from. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="query_params_one"><span class="id" title="lemma">query_params_one</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>} (<span class="id" title="var">h</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) <span class="id" title="var">p</span> (<span class="id" title="var">m1</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">m2</span>: <a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a>) <span class="id" title="var">n</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a> <a class="idref" href="coqrel.Monotonicity.html#h"><span class="id" title="variable">h</span></a> (<a class="idref" href="coqrel.Monotonicity.html#p"><span class="id" title="variable">p</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Peano.html#b3eea360671e1b32b18a26e15b3aace3"><span class="id" title="notation">+</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#QueryParams"><span class="id" title="class">QueryParams</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If neither head term is an existential variable, then the <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a></span>
  declarations for both should agree. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="query_params_both"><span class="id" title="lemma">query_params_both</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span>} (<span class="id" title="var">h1</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">h2</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">p1</span> <span class="id" title="var">p2</span> (<span class="id" title="var">m1</span>: <a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a>) (<span class="id" title="var">m2</span>: <a class="idref" href="coqrel.Monotonicity.html#D"><span class="id" title="variable">D</span></a>) <span class="id" title="var">n</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a> <a class="idref" href="coqrel.Monotonicity.html#h1"><span class="id" title="variable">h1</span></a> (<a class="idref" href="coqrel.Monotonicity.html#p1"><span class="id" title="variable">p1</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Peano.html#b3eea360671e1b32b18a26e15b3aace3"><span class="id" title="notation">+</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a> <a class="idref" href="coqrel.Monotonicity.html#h2"><span class="id" title="variable">h2</span></a> (<a class="idref" href="coqrel.Monotonicity.html#p2"><span class="id" title="variable">p2</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Peano.html#b3eea360671e1b32b18a26e15b3aace3"><span class="id" title="notation">+</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#QueryParams"><span class="id" title="class">QueryParams</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Now we need to choose which one of these lemmas to apply in a
  given situation, and compute the appropriate values for <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#p"><span class="id" title="variable">p</span></a></span>.
  We compute <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#p"><span class="id" title="variable">p</span></a></span> by essentially counting the products in the type of
  the related terms <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#m"><span class="id" title="variable">m</span></a></span>. Note that we need to make sure we "open up"
  types such as <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> to expose the products, accomplished here by
  using <span class="inlinecode"><span class="id" title="tactic">eval</span></span> <span class="inlinecode"><span class="id" title="tactic">cbv</span></span>. 
<div class="paragraph"> </div>

 FIXME: <span class="inlinecode"><span class="id" title="var">count_unapplied_params</span></span> fails if <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#m"><span class="id" title="variable">m</span></a></span> has a dependent type,
  due to <span class="inlinecode"><span class="id" title="var">t'</span></span> being a term under binders rather than a closed term.
  This means <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span> can't handle goal where the related terms
  have dependent types if the corresponding relational property is
  about a partial application. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">count_unapplied_params</span> <span class="id" title="var">m</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rec</span> <span class="id" title="var">count</span> <span class="id" title="var">t</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, ?<span class="id" title="var">t'</span> ⇒ <span class="id" title="keyword">let</span> <span class="id" title="var">n</span> := <span class="id" title="var">count</span> <span class="id" title="var">t'</span> <span class="id" title="keyword">in</span> <span class="id" title="keyword">constr</span>:(<a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="keyword">constr</span>:(<a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t</span> := <span class="id" title="var">type</span> <span class="id" title="var">of</span> <span class="id" title="var">m</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">cbv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">t</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">count</span> <span class="id" title="var">t</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">query_params</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rec</span> <span class="id" title="var">head</span> <span class="id" title="var">t</span> := <span class="id" title="keyword">lazymatch</span> <span class="id" title="var">t</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">t'</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">head</span> <span class="id" title="var">t'</span> | <span class="id" title="var">_</span> ⇒ <span class="id" title="var">t</span> <span class="id" title="keyword">end</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">h1</span> := <span class="id" title="var">head</span> <span class="id" title="var">m1</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">p1</span> := <span class="id" title="var">count_unapplied_params</span> <span class="id" title="var">m1</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">h2</span> := <span class="id" title="var">head</span> <span class="id" title="var">m2</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">p2</span> := <span class="id" title="var">count_unapplied_params</span> <span class="id" title="var">m2</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">not_evar</span> <span class="id" title="var">h1</span>; <span class="id" title="var">not_evar</span> <span class="id" title="var">h2</span>; <span class="id" title="tactic">eapply</span> (<a class="idref" href="coqrel.Monotonicity.html#query_params_both"><span class="id" title="lemma">query_params_both</span></a> <span class="id" title="var">h1</span> <span class="id" title="var">h2</span> <span class="id" title="var">p1</span> <span class="id" title="var">p2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">not_evar</span> <span class="id" title="var">h1</span>; <span class="id" title="var">is_evar</span>  <span class="id" title="var">h2</span>; <span class="id" title="tactic">eapply</span> (<a class="idref" href="coqrel.Monotonicity.html#query_params_one"><span class="id" title="lemma">query_params_one</span></a> <span class="id" title="var">h1</span> <span class="id" title="var">p1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">is_evar</span>  <span class="id" title="var">h1</span>; <span class="id" title="var">not_evar</span> <span class="id" title="var">h2</span>; <span class="id" title="tactic">eapply</span> (<a class="idref" href="coqrel.Monotonicity.html#query_params_one"><span class="id" title="lemma">query_params_one</span></a> <span class="id" title="var">h2</span> <span class="id" title="var">p2</span>) ].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 10 (<a class="idref" href="coqrel.Monotonicity.html#QueryParams"><span class="id" title="class">QueryParams</span></a> ?<span class="id" title="var">m1</span> ?<span class="id" title="var">m2</span> <span class="id" title="var">_</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" title="var">query_params</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
Now that we can figure out how many parameters to drop, we use
  that information to construct the pair of prefixes we use to locate
  the relational property. We try the following (in this order):
<ul class="doclist">
<li> the whole applications <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#x1"><span class="id" title="variable">x1</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">xn</span></span> and <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#y1"><span class="id" title="variable">y1</span></a></span> <span class="inlinecode">...</span> <span class="inlinecode"><span class="id" title="var">yn</span></span>;

</li>
<li> prefixes constructed as above from user-declared <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a></span> instances;

</li>
<li> the smallest prefix we can obtain by dropping arguments from
      both applications simulataneously.

</li>
</ul>

<div class="paragraph"> </div>

  Again, we need to take into account that either application could
  contain an eixstential variable. When we encounter an existential
  variable while chopping off arguments, we short-circuit the process
  and simply generate a new evar to serve as the shortened version. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">pass_evar_to</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">Av</span> := <span class="id" title="tactic">fresh</span> "A" <span class="id" title="keyword">in</span> <span class="id" title="tactic">evar</span> (<span class="id" title="var">Av</span> : <span class="id" title="keyword">Type</span>);<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">A</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">red</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Av</span> <span class="id" title="keyword">in</span> <span class="id" title="tactic">clear</span> <span class="id" title="var">Av</span>;<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">av</span> := <span class="id" title="tactic">fresh</span> "a" <span class="id" title="keyword">in</span> <span class="id" title="tactic">evar</span> (<span class="id" title="var">av</span> : <span class="id" title="var">A</span>);<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">a</span> := <span class="id" title="tactic">eval</span> <span class="id" title="tactic">red</span> <span class="id" title="keyword">in</span> <span class="id" title="var">av</span> <span class="id" title="keyword">in</span> <span class="id" title="tactic">clear</span> <span class="id" title="var">av</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">k</span> <span class="id" title="var">a</span>.<br/>

<br/>
</div>

<div class="doc">
The class <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#RemoveParams"><span class="id" title="record">RemoveParams</span></a></span> implements the concurrent removal of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span>
  parameters from applications <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a></span> and <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="RemoveParams"><span class="id" title="record">RemoveParams</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span>} (<span class="id" title="var">n</span>: <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) (<span class="id" title="var">m1</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">m2</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">f</span>: <a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a>) (<span class="id" title="var">g</span>: <a class="idref" href="coqrel.Monotonicity.html#D"><span class="id" title="variable">D</span></a>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">remove_params_from</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="var">n</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Datatypes.html#O"><span class="id" title="constructor">O</span></a> ⇒ <span class="id" title="var">k</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Datatypes.html#S"><span class="id" title="constructor">S</span></a> ?<span class="id" title="var">n'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| ?<span class="id" title="var">m'</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">remove_params_from</span> <span class="id" title="var">n'</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">is_evar</span> <span class="id" title="var">m</span>; <span class="id" title="var">pass_evar_to</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">remove_params</span> <span class="id" title="var">n</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">remove_params_from</span> <span class="id" title="var">n</span> <span class="id" title="var">m1</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">m1'</span> ⇒ <span class="id" title="var">unify</span> <span class="id" title="var">f</span> <span class="id" title="var">m1'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remove_params_from</span> <span class="id" title="var">n</span> <span class="id" title="var">m2</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">m2'</span> ⇒ <span class="id" title="var">unify</span> <span class="id" title="var">g</span> <span class="id" title="var">m2'</span>)).<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="coqrel.Monotonicity.html#RemoveParams"><span class="id" title="class">RemoveParams</span></a> ?<span class="id" title="var">n</span> ?<span class="id" title="var">m1</span> ?<span class="id" title="var">m2</span> ?<span class="id" title="var">f</span> ?<span class="id" title="var">g</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" title="var">remove_params</span> <span class="id" title="var">n</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>; <span class="id" title="tactic">constructor</span> : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
The class <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#RemoveAllParams"><span class="id" title="record">RemoveAllParams</span></a></span> implements the concurrent removal of
  as many arguments as possible. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="RemoveAllParams"><span class="id" title="record">RemoveAllParams</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span>} (<span class="id" title="var">m1</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">m2</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">f</span>: <a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a>) (<span class="id" title="var">g</span>: <a class="idref" href="coqrel.Monotonicity.html#D"><span class="id" title="variable">D</span></a>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">remove_all_params_from</span> <span class="id" title="var">m</span> <span class="id" title="var">k</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| ?<span class="id" title="var">m'</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">remove_all_params_from</span> <span class="id" title="var">m'</span> <span class="id" title="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <span class="id" title="var">not_evar</span> <span class="id" title="var">m</span>; <span class="id" title="var">k</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">remove_all_params</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">is_evar</span> <span class="id" title="var">m2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remove_all_params_from</span> <span class="id" title="var">m1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">m1'</span> ⇒ <span class="id" title="var">unify</span> <span class="id" title="var">f</span> <span class="id" title="var">m1'</span>; <span class="id" title="var">pass_evar_to</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">m2'</span> ⇒ <span class="id" title="var">unify</span> <span class="id" title="var">g</span> <span class="id" title="var">m2'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">is_evar</span> <span class="id" title="var">m1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remove_all_params_from</span> <span class="id" title="var">m2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">m2'</span> ⇒ <span class="id" title="var">unify</span> <span class="id" title="var">g</span> <span class="id" title="var">m2'</span>; <span class="id" title="var">pass_evar_to</span> <span class="id" title="keyword">ltac</span>:(<span class="id" title="keyword">fun</span> <span class="id" title="var">m1'</span> ⇒ <span class="id" title="var">unify</span> <span class="id" title="var">f</span> <span class="id" title="var">m1'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">lazymatch</span> <span class="id" title="var">m1</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">m1'</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="var">m2</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">m2'</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">remove_all_params</span> <span class="id" title="var">m1'</span> <span class="id" title="var">m2'</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">not_evar</span> <span class="id" title="var">m1</span>; <span class="id" title="var">unify</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">not_evar</span> <span class="id" title="var">m2</span>; <span class="id" title="var">unify</span> <span class="id" title="var">g</span> <span class="id" title="var">m2</span> ].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="coqrel.Monotonicity.html#RemoveAllParams"><span class="id" title="class">RemoveAllParams</span></a> ?<span class="id" title="var">m1</span> ?<span class="id" title="var">m2</span> ?<span class="id" title="var">f</span> ?<span class="id" title="var">g</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" title="var">remove_all_params</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">f</span> <span class="id" title="var">g</span>; <span class="id" title="tactic">constructor</span> : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab52"></a><h3 class="section">Selecting a relational property</h3>

<div class="paragraph"> </div>

 With this machinery in place, we can implement the search for
  candidate relational properties to use in conjunction with a given
  goal <span class="inlinecode"><a class="idref" href="coqrel.Delay.html#Q"><span class="id" title="variable">Q</span></a></span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="CandidateProperty"><span class="id" title="record">CandidateProperty</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">R'</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">f</span> <span class="id" title="var">g</span> (<span class="id" title="var">Q</span>: <span class="id" title="keyword">Prop</span>) :=<br/>
&nbsp;&nbsp;<a name="candidate_related"><span class="id" title="projection">candidate_related</span></a>: <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a name="as_is_candidate"><span class="id" title="instance">as_is_candidate</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">R</span> <span class="id" title="var">R'</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="class">Related</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="class">CandidateProperty</span></a> <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a>) | 10.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a name="remove_params_candidate"><span class="id" title="instance">remove_params_candidate</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span>} <span class="id" title="var">R</span> (<span class="id" title="var">m1</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">m2</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">R'</span> (<span class="id" title="var">f</span>: <a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a>) (<span class="id" title="var">g</span>: <a class="idref" href="coqrel.Monotonicity.html#D"><span class="id" title="variable">D</span></a>) <span class="id" title="var">n</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#QueryParams"><span class="id" title="class">QueryParams</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#RemoveParams"><span class="id" title="class">RemoveParams</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="class">Related</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a> <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="class">CandidateProperty</span></a> <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a>) | 20.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Instance</span> <a name="remove_all_params_candidate"><span class="id" title="instance">remove_all_params_candidate</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span>} <span class="id" title="var">R</span> (<span class="id" title="var">m1</span>:<a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">m2</span>:<a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">R'</span> (<span class="id" title="var">f</span>:<a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a>) (<span class="id" title="var">g</span>:<a class="idref" href="coqrel.Monotonicity.html#D"><span class="id" title="variable">D</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#RemoveAllParams"><span class="id" title="class">RemoveAllParams</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="class">Related</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a> <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="class">CandidateProperty</span></a> <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a>) | 30.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We also attempt to use any matching hypothesis. This takes
  priority and bypasses any <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" title="class">Params</span></a></span> declaration. We assume that we
  will always want such hypotheses to be used, at least when the left-
  or right-hand side matches exactly. There is a possibility that this
  ends up being too broad for some applications, for which we'll want
  to restrict ourselves to <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="record">Related</span></a></span> instances explicitely defined by
  the user. If this turns out to be the case, we can introduce an
  intermediate class with more parameters to control the sources of
  the relational properties we use, and perhaps have some kind of
  normalization process akin to what is done in <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#"><span class="id" title="library">Coq.Classes.Morphisms</span></a></span>.

<div class="paragraph"> </div>

  We don't hesitate to instantiate evars in the goal or hypothesis; if
  the types or skeletons are compatible this is likely what we want.
  In one practical case where this is needed, my hypothesis is
  something like <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R"><span class="id" title="variable">R</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#x1"><span class="id" title="variable">x1</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#y1"><span class="id" title="variable">y1</span></a></span> <span class="inlinecode">42)</span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#x2"><span class="id" title="variable">x2</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#y2"><span class="id" title="variable">y2</span></a></span> <span class="inlinecode">24)</span>, and I want
  <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#x1"><span class="id" title="variable">x1</span></a></span>, <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#x2"><span class="id" title="variable">x2</span></a></span>, <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#y1"><span class="id" title="variable">y1</span></a></span>, <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#y2"><span class="id" title="variable">y2</span></a></span> to be matched against the goal. In case
  the use of <span class="inlinecode"><span class="id" title="var">unify</span></span> below is too broad, we could develop a strategy
  whereby at least one of the head terms <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span>, <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> should match exactly.

<div class="paragraph"> </div>

  We also consider the possibility that the relation's arguments may
  be flipped in the hypothesis. In that case we wrap the relation with
  <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a></span> to construct a corresponding <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="record">CandidateProperty</span></a></span>. This <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a></span>
  will most likely be handled at the <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="record">RElim</span></a></span> stage by <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#flip_relim"><span class="id" title="lemma">flip_relim</span></a></span>.
  The hypothesis relation itself may be of the form <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R"><span class="id" title="variable">R</span></a></span>. In that
  case, the <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="record">CandidateProperty</span></a></span> will use <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a></span> <span class="inlinecode">(<a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R"><span class="id" title="variable">R</span></a>)</span> and
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#flip_relim"><span class="id" title="lemma">flip_relim</span></a></span> will simply be used twice. In more common and subtle
  variation, the hypothesis relation is not directly of this form, but
  should either be instantiated or refined (through <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span>) into
  such a form. This is handled by <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#rimpl_flip_subrel"><span class="id" title="instance">rimpl_flip_subrel</span></a></span>.

<div class="paragraph"> </div>

  Such issues are especially common when solving a goal of the
  form <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#R"><span class="id" title="variable">R</span></a></span> <span class="inlinecode">--&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelOperators.html#R'"><span class="id" title="variable">R'</span></a>)</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span>, or goals generated by the setoid rewriting
  system of the form <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.Morphisms.html#Proper"><span class="id" title="class">Proper</span></a></span> <span class="inlinecode">(?<a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">...</span> <span class="inlinecode">==&gt;</span> <span class="inlinecode">?<span class="id" title="var">Rn</span></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a></span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#impl"><span class="id" title="definition">impl</span></a>)</span>,
  and where the <span class="inlinecode">?<span class="id" title="var">Ri</span></span>s will generally need to be instantiated as
  <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a></span> <span class="inlinecode">?<span class="id" title="var">Ri'</span></span>. We do not pursue a similar strategy when looking up
  candidates from the typeclass instance database, because we expect
  the user to normalize such properties before they declare them, for
  example declare an instance of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="record">Related</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a></span> <span class="inlinecode">--&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R3"><span class="id" title="variable">R3</span></a>)</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span>
  rather than an instance of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" title="record">Related</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">--&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R3"><span class="id" title="variable">R3</span></a>)</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#g"><span class="id" title="variable">g</span></a></span>.

<div class="paragraph"> </div>

  Note that it is important that we reduce the goal to <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#R"><span class="id" title="variable">R</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#m"><span class="id" title="variable">m</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a></span>
  before we use <span class="inlinecode"><span class="id" title="tactic">eexact</span></span>: if the relation in the hypothesis is an
  existential variable, we don't want it unified against
  <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="record">CandidateProperty</span></a></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode"><span class="id" title="var">_</span></span> <span class="inlinecode">(<span class="id" title="var">_</span></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#m"><span class="id" title="variable">m</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#n"><span class="id" title="variable">n</span></a>)</span>. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="flip_context_candidate"><span class="id" title="lemma">flip_context_candidate</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">x</span> <span class="id" title="var">y</span> : <a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="coqrel.Monotonicity.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a> <a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="coqrel.Monotonicity.html#y"><span class="id" title="variable">y</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">context_candidate</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rec</span> <span class="id" title="var">is_prefix</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">unify</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">lazymatch</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">n</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">is_prefix</span> <span class="id" title="var">f</span> <span class="id" title="var">n</span> <span class="id" title="keyword">end</span> ] <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">rec</span> <span class="id" title="var">is_prefixable</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">is_evar</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">is_evar</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">unify</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">lazymatch</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">n</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">is_prefixable</span> <span class="id" title="var">f</span> <span class="id" title="var">n</span> <span class="id" title="keyword">end</span> ] <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">multimatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">H</span>: <span class="id" title="var">_</span> ?<span class="id" title="var">f</span> ?<span class="id" title="var">g</span> |- @<a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="class">CandidateProperty</span></a> ?<span class="id" title="var">A</span> ?<span class="id" title="var">B</span> ?<span class="id" title="var">R</span> ?<span class="id" title="var">x</span> ?<span class="id" title="var">y</span> (<span class="id" title="var">_</span> ?<span class="id" title="var">m</span> ?<span class="id" title="var">n</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">red</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">once</span> <span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">is_prefix</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span>; <span class="id" title="var">is_prefixable</span> <span class="id" title="var">g</span> <span class="id" title="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">is_prefix</span> <span class="id" title="var">g</span> <span class="id" title="var">n</span>; <span class="id" title="var">is_prefixable</span> <span class="id" title="var">f</span> <span class="id" title="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">is_prefix</span> <span class="id" title="var">g</span> <span class="id" title="var">m</span>; <span class="id" title="var">is_prefixable</span> <span class="id" title="var">f</span> <span class="id" title="var">n</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="coqrel.Monotonicity.html#flip_context_candidate"><span class="id" title="lemma">flip_context_candidate</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">is_prefix</span> <span class="id" title="var">f</span> <span class="id" title="var">n</span>; <span class="id" title="var">is_prefixable</span> <span class="id" title="var">g</span> <span class="id" title="var">m</span>; <span class="id" title="tactic">apply</span> <a class="idref" href="coqrel.Monotonicity.html#flip_context_candidate"><span class="id" title="lemma">flip_context_candidate</span></a> ];<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eexact</span> <span class="id" title="var">H</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="class">CandidateProperty</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" title="var">context_candidate</span> : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab53"></a><h3 class="section">Using <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span></h3>

<div class="paragraph"> </div>

 It is not obvious at what point in the process <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> should be
  hooked in. One thing we crucially want to avoid is an open-ended
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> search enumerating all possibilities to be filtered later,
  with a high potential for exponential blow-up should the user be a
  little too liberal with the <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> instances they declare.

<div class="paragraph"> </div>

  Here I choose to have it kick in after a candidate property has been
  selected, and we know how to apply it to a goal. Then we use
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> to bridge any gap between that goal and the actual one,
  through the <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#RImpl"><span class="id" title="record">RImpl</span></a></span> class below.

<div class="paragraph"> </div>

  This is a conservative solution which precludes many interesting
  usages of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span>. For instance, suppose we have a relational
  property alogn the lines of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Monotonic"><span class="id" title="abbreviation">Monotonic</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> <span class="inlinecode">((<a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a>)</span> <span class="inlinecode">∩</span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a>))</span>.
  We would want to be able to use it to show that <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#f"><span class="id" title="variable">f</span></a></span> preserve <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> or
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a></span> individually (because <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a>)</span> <span class="inlinecode">((<a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a>)</span> <span class="inlinecode">∩</span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a></span>
  <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a>))</span>, but also together (because <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">∩</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">∩</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a>)</span>
  <span class="inlinecode">((<a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R1"><span class="id" title="variable">R1</span></a>)</span> <span class="inlinecode">∩</span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#R2"><span class="id" title="variable">R2</span></a>))</span>). This cannot be done using this
  approach, which does not act on the relational property itself but
  only the goal we're attempting to prove.

<div class="paragraph"> </div>

  Perhaps in the future we can extend this by acting at the level of
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="record">RElim</span></a></span>. In any case, we should provide explicit guidelines for when
  to declare <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> instances, and how. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="RImpl"><span class="id" title="record">RImpl</span></a> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span>: <span class="id" title="keyword">Prop</span>): <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a name="rimpl"><span class="id" title="projection">rimpl</span></a>: <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
</div>

<div class="doc">
While we give priority to <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#rimpl_refl"><span class="id" title="instance">rimpl_refl</span></a></span> below, when it doesn't work
  we use <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RAuto"><span class="id" title="record">RAuto</span></a></span> to establish a <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> property. The <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Monotonic"><span class="id" title="abbreviation">Monotonic</span></a></span>
  instances we declared alongside relators can be used conjunction
  with <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#Monotonicity"><span class="id" title="record">Monotonicity</span></a></span> to break up <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> goals along the structure
  of the relations being considered. This may end up causing loops
  (especially in failure cases), so it may be necessary to add some
  flag in the context to prevent <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#rimpl_subrel"><span class="id" title="instance">rimpl_subrel</span></a></span> from being used when
  discharging the <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> goals themselves. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="rimpl_refl"><span class="id" title="instance">rimpl_refl</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">R</span> : <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">m</span> <span class="id" title="var">n</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#RImpl"><span class="id" title="class">RImpl</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>) (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="rimpl_subrel"><span class="id" title="instance">rimpl_subrel</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">R</span> <span class="id" title="var">R'</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">m</span> <span class="id" title="var">n</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Delay.html#NonDelayed"><span class="id" title="class">NonDelayed</span></a> (<a class="idref" href="coqrel.RelDefinitions.html#RAuto"><span class="id" title="class">RAuto</span></a> (<a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a> <a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a>)) <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#RImpl"><span class="id" title="class">RImpl</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>) (<a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="rimpl_flip_subrel"><span class="id" title="instance">rimpl_flip_subrel</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} <span class="id" title="var">R</span> <span class="id" title="var">R'</span> (<span class="id" title="var">x</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">y</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Delay.html#NonDelayed"><span class="id" title="class">NonDelayed</span></a> (<a class="idref" href="coqrel.RelDefinitions.html#RAuto"><span class="id" title="class">RAuto</span></a> (<a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a> <a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Program.Basics.html#flip"><span class="id" title="definition">flip</span></a> <a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a>))) <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#RImpl"><span class="id" title="class">RImpl</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="coqrel.Monotonicity.html#y"><span class="id" title="variable">y</span></a>) (<a class="idref" href="coqrel.Monotonicity.html#R'"><span class="id" title="variable">R'</span></a> <a class="idref" href="coqrel.Monotonicity.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="coqrel.Monotonicity.html#x"><span class="id" title="variable">x</span></a>) | 2.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab54"></a><h3 class="section">Main tactic</h3>

<div class="paragraph"> </div>

 With these components, defining the <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span> tactic is
  straightforward: identify a candidate property, then figure out a
  way to apply it to the goal <span class="inlinecode"><a class="idref" href="coqrel.Delay.html#Q"><span class="id" title="variable">Q</span></a></span> using the <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="record">RElim</span></a></span> class. We first
  define a <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#Monotonicity"><span class="id" title="record">Monotonicity</span></a></span> typeclass that captures this behavior with
  full backtracking ability. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="Monotonicity"><span class="id" title="record">Monotonicity</span></a> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span>: <span class="id" title="keyword">Prop</span>): <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a name="monotonicity"><span class="id" title="projection">monotonicity</span></a>: <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="apply_candidate"><span class="id" title="instance">apply_candidate</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">m</span> <span class="id" title="var">n</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">Q'</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="class">CandidateProperty</span></a> <a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="class">RElim</span></a> <a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q'"><span class="id" title="variable">Q'</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#RImpl"><span class="id" title="class">RImpl</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q'"><span class="id" title="variable">Q'</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#Monotonicity"><span class="id" title="class">Monotonicity</span></a> <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The Ltac tactic simply applies <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span>; typeclass
  resolution will do the rest. Note that using <span class="inlinecode"><span class="id" title="tactic">apply</span></span> naively is too
  lenient because in a goal of type <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#A"><span class="id" title="variable">A</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#B"><span class="id" title="variable">B</span></a></span>, it will end up unifying
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#A"><span class="id" title="variable">A</span></a></span> with <span class="inlinecode"><a class="idref" href="coqrel.Delay.html#P"><span class="id" title="variable">P</span></a></span> and <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#B"><span class="id" title="variable">B</span></a></span> with <span class="inlinecode"><a class="idref" href="coqrel.Delay.html#Q"><span class="id" title="variable">Q</span></a></span> instead of setting <span class="inlinecode"><a class="idref" href="coqrel.Delay.html#Q"><span class="id" title="variable">Q</span></a></span> <span class="inlinecode">:=</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#A"><span class="id" title="variable">A</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#B"><span class="id" title="variable">B</span></a></span> and
  generating a new subgoal for <span class="inlinecode"><a class="idref" href="coqrel.Delay.html#P"><span class="id" title="variable">P</span></a></span> as expected. On the other hand,
  using <span class="inlinecode"><span class="id" title="tactic">refine</span></span> directly is too restrictive because it will not unify
  the type of <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span> against the goal if existential variables
  are present in one or the other. Hence we constrain apply just
  enough, so as to handle both of these cases. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">monotonicity</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- ?<span class="id" title="var">Q</span> ⇒ <span class="id" title="tactic">apply</span> (<a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="definition">monotonicity</span></a> (<span class="id" title="var">Q</span>:=<span class="id" title="var">Q</span>)) <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">Delay.split_conjunction</span>.<br/>

<br/>
</div>

<div class="doc">
Another way to use <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#Monotonicity"><span class="id" title="record">Monotonicity</span></a></span> is to hook it as an <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RStep"><span class="id" title="record">RStep</span></a></span>
  instance. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="monotonicity_rstep"><span class="id" title="instance">monotonicity_rstep</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} (<span class="id" title="var">P</span>: <span class="id" title="keyword">Prop</span>) (<span class="id" title="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">m</span> <span class="id" title="var">n</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#Monotonicity"><span class="id" title="class">Monotonicity</span></a> <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#RStep"><span class="id" title="class">RStep</span></a> <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>) | 50.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab55"></a><h3 class="section"><span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> constraint as a subgoal</h3>

<div class="paragraph"> </div>

 When <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" title="projection">monotonicity</span></a></span> fails it can be hard to figure out what is
  going wrong, especially if the problem occurs in the <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a></span> goal
  of <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#rimpl_subrel"><span class="id" title="instance">rimpl_subrel</span></a></span>. The following tactic emits this constraint as a
  subgoal instead of solving it with <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RAuto"><span class="id" title="record">RAuto</span></a></span>, so that the user can
  figure out what's broken and/or prove it manually in contexts where
  an automatic resolution is tricky.  
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="SubrelMonotonicity"><span class="id" title="record">SubrelMonotonicity</span></a> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span>: <span class="id" title="keyword">Prop</span>): <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a name="subrel_monotonicity"><span class="id" title="projection">subrel_monotonicity</span></a>: <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q"><span class="id" title="variable">Q</span></a>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="apply_candidate_subrel"><span class="id" title="instance">apply_candidate_subrel</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span> <span class="id" title="var">D</span>} (<span class="id" title="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" title="definition">rel</span></a> <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) <span class="id" title="var">m</span> <span class="id" title="var">n</span> <span class="id" title="var">P</span> <span class="id" title="var">Rc</span> <span class="id" title="var">Rg</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="class">CandidateProperty</span></a> <a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a> (<a class="idref" href="coqrel.Monotonicity.html#Rg"><span class="id" title="variable">Rg</span></a> <a class="idref" href="coqrel.Monotonicity.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="coqrel.Monotonicity.html#y"><span class="id" title="variable">y</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="class">RElim</span></a> <a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> (<a class="idref" href="coqrel.Monotonicity.html#Rc"><span class="id" title="variable">Rc</span></a> <a class="idref" href="coqrel.Monotonicity.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="coqrel.Monotonicity.html#y"><span class="id" title="variable">y</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#SubrelMonotonicity"><span class="id" title="class">SubrelMonotonicity</span></a> (@<a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" title="definition">subrel</span></a> <a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a> <a class="idref" href="coqrel.Monotonicity.html#D"><span class="id" title="variable">D</span></a> <a class="idref" href="coqrel.Monotonicity.html#Rc"><span class="id" title="variable">Rc</span></a> <a class="idref" href="coqrel.Monotonicity.html#Rg"><span class="id" title="variable">Rg</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">∧</span></a> <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a>) (<a class="idref" href="coqrel.Monotonicity.html#Rg"><span class="id" title="variable">Rg</span></a> <a class="idref" href="coqrel.Monotonicity.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="coqrel.Monotonicity.html#y"><span class="id" title="variable">y</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">subrel_monotonicity</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span> |- ?<span class="id" title="var">Q</span> ⇒ <span class="id" title="tactic">apply</span> (<a class="idref" href="coqrel.Monotonicity.html#subrel_monotonicity"><span class="id" title="definition">subrel_monotonicity</span></a> (<span class="id" title="var">Q</span>:=<span class="id" title="var">Q</span>)) <span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" title="var">Delay.split_conjunction</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab56"></a><h2 class="section">Generic instances</h2>

<div class="paragraph"> </div>

 When all else fail, we would like to fall back on a behavior
  similar to that of <span class="inlinecode"><span class="id" title="tactic">f_equal</span></span>. To that end, we add a default
  <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="record">CandidateProperty</span></a></span> that identifies the longest common prefix of the
  applications in the goal and asserts that they are equal. 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Class</span> <a name="CommonPrefix"><span class="id" title="record">CommonPrefix</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>} (<span class="id" title="var">m1</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">m2</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">f</span>: <a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a>).<br/>

<br/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">common_prefix</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">f</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="tactic">first</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;[ <span class="id" title="var">not_evar</span> <span class="id" title="var">m1</span>; <span class="id" title="var">not_evar</span> <span class="id" title="var">m2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unify</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>; <span class="id" title="var">unify</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="keyword">lazymatch</span> <span class="id" title="var">m1</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">m1'</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">lazymatch</span> <span class="id" title="var">m2</span> <span class="id" title="keyword">with</span> ?<span class="id" title="var">m2'</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">common_prefix</span> <span class="id" title="var">m1'</span> <span class="id" title="var">m2'</span> <span class="id" title="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">unify</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span>; <span class="id" title="var">unify</span> <span class="id" title="var">f</span> <span class="id" title="var">m1</span> ].<br/>

<br/>
<span class="id" title="keyword">Hint Extern</span> 1 (<a class="idref" href="coqrel.Monotonicity.html#CommonPrefix"><span class="id" title="class">CommonPrefix</span></a> ?<span class="id" title="var">m1</span> ?<span class="id" title="var">m2</span> ?<span class="id" title="var">f</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" title="var">common_prefix</span> <span class="id" title="var">m1</span> <span class="id" title="var">m2</span> <span class="id" title="var">f</span>; <span class="id" title="tactic">constructor</span> : <span class="id" title="var">typeclass_instances</span>.<br/>

<br/>
<span class="id" title="keyword">Global Instance</span> <a name="eq_candidate"><span class="id" title="instance">eq_candidate</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span> <span class="id" title="var">C</span>} <span class="id" title="var">R</span> (<span class="id" title="var">m1</span>: <a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a>) (<span class="id" title="var">m2</span>: <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>) (<span class="id" title="var">f</span>: <a class="idref" href="coqrel.Monotonicity.html#C"><span class="id" title="variable">C</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#CommonPrefix"><span class="id" title="class">CommonPrefix</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Monotonicity.html#CandidateProperty"><span class="id" title="class">CandidateProperty</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#eq"><span class="id" title="inductive">eq</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> (<a class="idref" href="coqrel.Monotonicity.html#R"><span class="id" title="variable">R</span></a> <a class="idref" href="coqrel.Monotonicity.html#m1"><span class="id" title="variable">m1</span></a> <a class="idref" href="coqrel.Monotonicity.html#m2"><span class="id" title="variable">m2</span></a>) | 100.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">firstorder</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Then, we can use the following <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="record">RElim</span></a></span> instance to obtain the
  behavior of the <span class="inlinecode"><span class="id" title="tactic">f_equal</span></span> tactic.

<div class="paragraph"> </div>

  In practice, I find that <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#f_equal_relim"><span class="id" title="lemma">f_equal_relim</span></a></span> is too broadly applicable.
  In situations where a relational property is missing or inapplicable
  for some reason, we would like <span class="inlinecode"><span class="id" title="tactic">repeat</span></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#rstep"><span class="id" title="projection">rstep</span></a></span> to leave us in a
  situation where we can examine what is going wrong, or do a manual
  proof when necessary. If we use <span class="inlinecode"><span class="id" title="tactic">f_equal</span></span>-like behavior as a
  default, we will instead be left several step further, where it is
  no longer obvious which function is involved, and where the goal may
  not be provable anymore.

<div class="paragraph"> </div>

  With that said, if you would like to switch <span class="inlinecode"><span class="id" title="tactic">f_equal</span></span> on, you can
  register <span class="inlinecode"><span class="id" title="var">f_equal_elim</span></span> as an instance with the following hint:
<pre>
    Hint Extern 1 (RElim (@eq (_ -&gt; _)) _ _ _ _) =&gt;
      eapply f_equal_relim : typeclass_instances.
</pre>
 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="f_equal_relim"><span class="id" title="lemma">f_equal_relim</span></a> {<span class="id" title="var">A</span> <span class="id" title="var">B</span>} <span class="id" title="var">f</span> <span class="id" title="var">g</span> <span class="id" title="var">m</span> <span class="id" title="var">n</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="class">RElim</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#eq"><span class="id" title="inductive">eq</span></a> (<a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a>) (<a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a>) <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a> <a class="idref" href="coqrel.Monotonicity.html#Q"><span class="id" title="variable">Q</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#RElim"><span class="id" title="class">RElim</span></a> (@<a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#eq"><span class="id" title="inductive">eq</span></a> (<a class="idref" href="coqrel.Monotonicity.html#A"><span class="id" title="variable">A</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="coqrel.Monotonicity.html#B"><span class="id" title="variable">B</span></a>)) <a class="idref" href="coqrel.Monotonicity.html#f"><span class="id" title="variable">f</span></a> <a class="idref" href="coqrel.Monotonicity.html#g"><span class="id" title="variable">g</span></a> (<a class="idref" href="coqrel.Monotonicity.html#m"><span class="id" title="variable">m</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="coqrel.Monotonicity.html#n"><span class="id" title="variable">n</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">∧</span></a> <a class="idref" href="coqrel.Monotonicity.html#P"><span class="id" title="variable">P</span></a>) <a class="idref" href="coqrel.Monotonicity.html#Q"><span class="id" title="variable">Q</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Helim</span> <span class="id" title="var">Hf</span> [<span class="id" title="var">Hmn</span> <span class="id" title="var">HP</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Helim</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">congruence</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Note that thanks to <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#eq_subrel"><span class="id" title="instance">eq_subrel</span></a></span>, this will also apply to a goal
  that uses a <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Classes.RelationClasses.html#Reflexive"><span class="id" title="class">Reflexive</span></a></span> relation, not just a goal that uses <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.6.1/stdlib/Coq.Init.Logic.html#eq"><span class="id" title="inductive">eq</span></a></span>.
  In fact, this subsumes the <span class="inlinecode"><span class="id" title="tactic">reflexivity</span></span> tactic as well, which
  corresponds to the special case where all arguments are equal;
  in that case <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#relim_base"><span class="id" title="instance">relim_base</span></a></span> can be used directly and <span class="inlinecode"><span class="id" title="var">f_equal_elim</span></span> is
  not necessary. 
</div>
<div class="code">
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>