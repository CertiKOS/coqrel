<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>coqrel.MorphismsCompat</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library coqrel.MorphismsCompat</h1>

<div class="code">
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="coqrel.RelDefinitions.html#"><span class="id" type="library">RelDefinitions</span></a>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="coqrel.RelOperators.html#"><span class="id" type="library">RelOperators</span></a>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="coqrel.Relators.html#"><span class="id" type="library">Relators</span></a>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="coqrel.Monotonicity.html#"><span class="id" type="library">Monotonicity</span></a>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Lists.List.html#"><span class="id" type="library">Coq.Lists.List</span></a>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab16"></a><h2 class="section">Resolution process</h2>

<div class="paragraph"> </div>

 Now that we have a way to express and register the monotonicity
  properties of various operators, we want to use them to answer the
  queries generated by setoid rewriting and the <span class="inlinecode"><a class="idref" href="coqrel.Monotonicity.html#monotonicity"><span class="id" type="projection">monotonicity</span></a></span> tactic.
  That is, given a relation <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> with existential holes and a term <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span>,
  use the registered theorems to prove <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span>, instantiating some of
  the existential holes in <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span>. All things being equal, we will want
  those instantiations to yield the strongest theorem possible.

<div class="paragraph"> </div>

  I use the following procedure, implemented below.

<div class="paragraph"> </div>

<ul class="doclist">
<li> First, choose an orientation. Since <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span> <span class="inlinecode">↔</span> <span class="inlinecode">(<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a>)</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span>,
      we need to consider both of those goals. Furthermore, we need to
      normalize <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> so that <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a></span> is pushed inward and any
      occurence of <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a></span> <span class="inlinecode">(<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Transport.html#Q"><span class="id" type="variable">Q</span></a>)</span> is reduced to <span class="inlinecode"><a class="idref" href="coqrel.Transport.html#Q"><span class="id" type="variable">Q</span></a></span>.

</li>
<li> Then, if <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span> is an applied function, we may want to look for a
      more general <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> theorem. So for instance, assuming that
      <span class="inlinecode"><a class="idref" href="coqrel.Transport.html#Q"><span class="id" type="variable">Q</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a></span>, we can use a theorem of the form <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.Transport.html#Q"><span class="id" type="variable">Q</span></a></span> <span class="inlinecode">++&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a>)</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#f"><span class="id" type="variable">f</span></a></span>
      to solve a goal of the form <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.LogicalRelationsTests.html#f"><span class="id" type="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a>)</span> <span class="inlinecode">(<a class="idref" href="coqrel.LogicalRelationsTests.html#f"><span class="id" type="variable">f</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a>)</span>.

</li>
<li> Once we've chosen an orientation and a degree of partial
      application, we can finally look for a corresponding <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span>
      instance.

</li>
</ul>

<div class="paragraph"> </div>

  We may want to add more phases in the future, for instance to
  generalize the goal using <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" type="record">subrel</span></a></span> instances.

<div class="paragraph"> </div>

  It is most convenient to embed this process into the typeclass
  resolution mechanism. In particular, nondeterministic choices come
  in handy. But we don't want these resolution steps to be applied
  arbitrarily. In order to enforce the sequential aspect, we use the
  proxy class <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="record">ProperQuery</span></a></span>, which is parametrized by a list of
  processing phases remaining. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <a name="processing_phase"><span class="id" type="inductive">processing_phase</span></a> :=<br/>
&nbsp;&nbsp;| <a name="proper_orientation"><span class="id" type="constructor">proper_orientation</span></a><br/>
&nbsp;&nbsp;| <a name="proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a><br/>
&nbsp;&nbsp;| <a name="proper_partial_arg"><span class="id" type="constructor">proper_partial_arg</span></a><br/>
&nbsp;&nbsp;| <a name="proper_subrel"><span class="id" type="constructor">proper_subrel</span></a>.<br/>

<br/>
<span class="id" type="keyword">Class</span> <a name="ProperQuery"><span class="id" type="record">ProperQuery</span></a> (φ<span class="id" type="var">s</span>: <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#list"><span class="id" type="inductive">list</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#processing_phase"><span class="id" type="inductive">processing_phase</span></a>) {<span class="id" type="var">A</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) :=<br/>
&nbsp;&nbsp;<a name="proper_query_outcome"><span class="id" type="projection">proper_query_outcome</span></a>: <a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>

<br/>
</div>

<div class="doc">
The different <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#processing_phase"><span class="id" type="inductive">processing_phase</span></a></span>s will peel themselves off the
  list and generate subgoals to be handled by the next phase.
  Ultimately the list becomes empty, and we look for a regular
  instance of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Global Instance</span> <a name="proper_query_finalize"><span class="id" type="instance">proper_query_finalize</span></a> {<span class="id" type="var">A</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" type="constructor">nil</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">tauto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab17"></a><h2 class="section">Flipping <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> goals</h2>

<div class="paragraph"> </div>

 Instances of this class can be used to indicate how <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a></span> is to
  be pushed to the inside of given relation operators. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Class</span> <a name="FlipsTo"><span class="id" type="record">FlipsTo</span></a> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#B"><span class="id" type="variable">B</span></a>) (<span class="id" type="var">R'</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#B"><span class="id" type="variable">B</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) :=<br/>
&nbsp;&nbsp;<a name="flips_to"><span class="id" type="projection">flips_to</span></a>: <a class="idref" href="coqrel.RelOperators.html#eqrel"><span class="id" type="definition">eqrel</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R'"><span class="id" type="variable">R'</span></a>.<br/>

<br/>
<span class="id" type="var">Arguments</span> <a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> {<span class="id" type="var">A</span>%<span class="id" type="var">type</span> <span class="id" type="var">B</span>%<span class="id" type="var">type</span>} <span class="id" type="var">R</span>%<span class="id" type="var">rel</span> <span class="id" type="var">R'</span>%<span class="id" type="var">rel</span>.<br/>

<br/>
</div>

<div class="doc">
Catch-all, default instance. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Instance</span> <a name="atom_flipsto"><span class="id" type="instance">atom_flipsto</span></a> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#B"><span class="id" type="variable">B</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a>) | 10.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Flipping twice. This instance is also used when the first argument
  is an existential variable, so that the resulting relation is itself
  as general as possible. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Instance</span> <a name="flip_flipsto"><span class="id" type="instance">flip_flipsto</span></a> {<span class="id" type="var">A</span> <span class="id" type="var">B</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#B"><span class="id" type="variable">B</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Symmetric relations flip to themselves. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Instance</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">∀</span> {<span class="id" type="var">A</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">HR</span>: <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.RelationClasses.html#Symmetric"><span class="id" type="class">Symmetric</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Instances for basic relators. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Instance</span> <a name="arrow_flipsto"><span class="id" type="instance">arrow_flipsto</span></a> {<span class="id" type="var">A1</span> <span class="id" type="var">A2</span> <span class="id" type="var">B1</span> <span class="id" type="var">B2</span>} (<span class="id" type="var">RA</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A1"><span class="id" type="variable">A1</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A2"><span class="id" type="variable">A2</span></a>) (<span class="id" type="var">RB</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#B1"><span class="id" type="variable">B1</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#B2"><span class="id" type="variable">B2</span></a>) <span class="id" type="var">RA'</span> <span class="id" type="var">RB'</span>:<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#RA"><span class="id" type="variable">RA</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#RA'"><span class="id" type="variable">RA'</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#RB"><span class="id" type="variable">RB</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#RB'"><span class="id" type="variable">RB'</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#RA"><span class="id" type="variable">RA</span></a> <a class="idref" href="coqrel.RelDefinitions.html#:rel_scope:x_'++>'_x"><span class="id" type="notation">++&gt;</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#RB"><span class="id" type="variable">RB</span></a>) (<a class="idref" href="coqrel.MorphismsCompat.html#RA'"><span class="id" type="variable">RA'</span></a> <a class="idref" href="coqrel.RelDefinitions.html#:rel_scope:x_'++>'_x"><span class="id" type="notation">++&gt;</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#RB'"><span class="id" type="variable">RB'</span></a>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a>, <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Program.Basics.html#flip"><span class="id" type="definition">flip</span></a>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_orientation"><span class="id" type="constructor">proper_orientation</span></a></span> phase causes both orientations to be tried. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Global Instance</span> <a name="proper_orientation_direct"><span class="id" type="instance">proper_orientation_direct</span></a> φ<span class="id" type="var">s</span> {<span class="id" type="var">A</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_orientation"><span class="id" type="constructor">proper_orientation</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">tauto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="proper_orientation_flip"><span class="id" type="lemma">proper_orientation_flip</span></a> φ<span class="id" type="var">s</span> {<span class="id" type="var">A</span>} (<span class="id" type="var">R</span> <span class="id" type="var">R'</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R'"><span class="id" type="variable">R'</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R'"><span class="id" type="variable">R'</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_orientation"><span class="id" type="constructor">proper_orientation</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
For <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_orientation_flip"><span class="id" type="lemma">proper_orientation_flip</span></a></span> above, we only want to use the
  first instance of <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="record">FlipsTo</span></a></span> found. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">proper_orientation_flip</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">lazymatch</span> <span class="id" type="keyword">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- @<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> <span class="id" type="var">_</span> ?<span class="id" type="var">A</span> ?<span class="id" type="var">R</span> ?<span class="id" type="var">m</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">Rv</span> := <span class="id" type="tactic">fresh</span> <span class="id" type="keyword">in</span> <span class="id" type="tactic">evar</span> (<span class="id" type="var">Rv</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <span class="id" type="var">A</span> <span class="id" type="var">A</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">R'</span> := <span class="id" type="tactic">eval</span> <span class="id" type="tactic">red</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Rv</span> <span class="id" type="keyword">in</span> <span class="id" type="tactic">clear</span> <span class="id" type="var">Rv</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">H</span> := <span class="id" type="tactic">fresh</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>: <a class="idref" href="coqrel.MorphismsCompat.html#FlipsTo"><span class="id" type="class">FlipsTo</span></a> <span class="id" type="var">R</span> <span class="id" type="var">R'</span>) <span class="id" type="tactic">by</span> <span class="id" type="var">typeclasses</span> <span class="id" type="tactic">eauto</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> (@<a class="idref" href="coqrel.MorphismsCompat.html#proper_orientation_flip"><span class="id" type="lemma">proper_orientation_flip</span></a> <span class="id" type="var">_</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">R'</span> <span class="id" type="var">m</span> <span class="id" type="var">H</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Hint Extern</span> 2 (<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_orientation"><span class="id" type="constructor">proper_orientation</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><span class="id" type="var">_</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" type="var">proper_orientation_flip</span> : <span class="id" type="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab18"></a><h2 class="section">Partial applications</h2>

<div class="paragraph"> </div>

 In many contexts, we need to show <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> <span class="inlinecode"><span class="id" type="var">Rg</span></span> <span class="inlinecode">(<a class="idref" href="coqrel.LogicalRelationsTests.html#op"><span class="id" type="variable">op</span></a></span> <span class="inlinecode"><span class="id" type="var">a₁</span></span> <span class="inlinecode">…</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#a"><span class="id" type="variable">a</span></a>ₖ</span> <span class="inlinecode">…</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#a"><span class="id" type="variable">a</span></a>ₙ)</span>,
  but what we acually have is a more general instance of
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.LogicalRelationsTests.html#op"><span class="id" type="variable">op</span></a></span> <span class="inlinecode"><span class="id" type="var">a₁</span></span> <span class="inlinecode">…</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#a"><span class="id" type="variable">a</span></a>ₖ)</span>. If <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> is built up from reflexive relations
  (or at least, relations for which the corresponding <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#a"><span class="id" type="variable">a</span></a>ᵢ</span> is a proper
  element), then the former can be obtained from the latter.

<div class="paragraph"> </div>

  In <span class="inlinecode"><span class="id" type="library">Coq.Classes.Morphisms</span></span>, this is handled by <span class="inlinecode"><span class="id" type="var">partial_application_tactic</span></span>,
  which applies <span class="inlinecode"><span class="id" type="var">Reflexive_partial_app_morphism</span></span> on a goal of the form
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R'"><span class="id" type="variable">R'</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.LogicalRelationsTests.html#op"><span class="id" type="variable">op</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a>)</span> to obtain the new goal <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> <span class="inlinecode">==&gt;</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R'"><span class="id" type="variable">R'</span></a>)</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#op"><span class="id" type="variable">op</span></a></span>,
  with <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> an existential variable to be unified against the <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span>
  instances of this form that are eventually found. However, we cannot
  naively extend this strategy to obtain goals of the form
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#forall_rel"><span class="id" type="definition">forall_rel</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a>)</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#op"><span class="id" type="variable">op</span></a></span>. We would need the many more existential
  variables <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#V"><span class="id" type="variable">V</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="keyword">Type</span></span>, <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#E"><span class="id" type="variable">E</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#V"><span class="id" type="variable">V</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#V"><span class="id" type="variable">V</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" type="keyword">Type</span></span>, <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#e"><span class="id" type="variable">e</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#E"><span class="id" type="variable">E</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a></span>,
  <span class="inlinecode"><span class="id" type="var">FV</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#V"><span class="id" type="variable">V</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" type="keyword">Type</span></span>, <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" type="keyword">∀</span></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#v1"><span class="id" type="variable">v1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#v2"><span class="id" type="variable">v2</span></a>,</span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#E"><span class="id" type="variable">E</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#v1"><span class="id" type="variable">v1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#v2"><span class="id" type="variable">v2</span></a></span> <span class="inlinecode">→</span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a></span> <span class="inlinecode">(<span class="id" type="var">FV</span></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#v1"><span class="id" type="variable">v1</span></a>)</span> <span class="inlinecode">(<span class="id" type="var">FV</span></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#v2"><span class="id" type="variable">v2</span></a>)</span>,
  and what's more we would have to perform the higher-order
  unification of <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R'"><span class="id" type="variable">R'</span></a></span> — likely just some existential variable at this
  point — against <span class="inlinecode">?<a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.Relators.html#v"><span class="id" type="variable">v</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.Relators.html#v"><span class="id" type="variable">v</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#e"><span class="id" type="variable">e</span></a></span>. <em>Maybe</em> this could be achieved
  by going through another existential variable within the context of
  a lambda abstraction such that <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> ≐ <span class="inlinecode">(<span class="id" type="keyword">fun</span></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#v1"><span class="id" type="variable">v1</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.Relators.html#v2"><span class="id" type="variable">v2</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#e"><span class="id" type="variable">e</span></a></span> <span class="inlinecode">⇒</span> <span class="inlinecode">?)</span> (if that
  is even possible). However the resulting unification process would
  be rather messy and undebuggable.

<div class="paragraph"> </div>

  Instead, we start with whatever instances of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> <span class="inlinecode">(<a class="idref" href="coqrel.RelDefinitions.html#forall_rel"><span class="id" type="definition">forall_rel</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a>)</span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#op"><span class="id" type="variable">op</span></a></span>
  we can find, then try to unify <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R'"><span class="id" type="variable">R'</span></a></span> against the corresponding
  mostly-concrete <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#R"><span class="id" type="variable">R</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#x"><span class="id" type="variable">x</span></a></span> <span class="inlinecode">?<a class="idref" href="coqrel.RelDefinitions.html#e"><span class="id" type="variable">e</span></a></span>. To this end, we use the following
  intermediate class. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Class</span> <a name="ProperApplies"><span class="id" type="record">ProperApplies</span></a> <span class="id" type="var">A</span> (<span class="id" type="var">B</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> → <span class="id" type="keyword">Type</span>) <span class="id" type="var">R</span> (<span class="id" type="var">a</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) <span class="id" type="var">R'</span> (<span class="id" type="var">m</span>: <span class="id" type="keyword">∀</span> <span class="id" type="var">a</span>, <a class="idref" href="coqrel.MorphismsCompat.html#B"><span class="id" type="variable">B</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#a"><span class="id" type="variable">a</span></a>) :=<br/>
&nbsp;&nbsp;<a name="proper_applies"><span class="id" type="projection">proper_applies</span></a> : <a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> → <a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R'"><span class="id" type="variable">R'</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#a"><span class="id" type="variable">a</span></a>).<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">proper_applies</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">H</span> := <span class="id" type="tactic">fresh</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <a class="idref" href="coqrel.MorphismsCompat.html#ProperApplies"><span class="id" type="class">ProperApplies</span></a>, <a class="idref" href="coqrel.RelDefinitions.html#Related"><span class="id" type="class">Related</span></a>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">H</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> (@<a class="idref" href="coqrel.MorphismsCompat.html#proper_query_outcome"><span class="id" type="definition">proper_query_outcome</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_arg"><span class="id" type="constructor">proper_partial_arg</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" type="constructor">nil</span></a>)).<br/>

<br/>
<span class="id" type="keyword">Hint Extern</span> 1 (<a class="idref" href="coqrel.MorphismsCompat.html#ProperApplies"><span class="id" type="class">ProperApplies</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" type="var">proper_applies</span> : <span class="id" type="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
The processing phase <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_arg"><span class="id" type="constructor">proper_partial_arg</span></a></span> is used for proving that
  a given argument can be applied. It is our version of
  <span class="inlinecode"><span class="id" type="var">Morphisms.ProperProxy</span></span>. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Instance</span> <a name="proper_partial_arg_eq"><span class="id" type="instance">proper_partial_arg_eq</span></a> φ<span class="id" type="var">s</span> {<span class="id" type="var">A</span>} (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_arg"><span class="id" type="constructor">proper_partial_arg</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Logic.html#eq"><span class="id" type="inductive">eq</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <a name="proper_partial_arg_reflexive"><span class="id" type="instance">proper_partial_arg_reflexive</span></a> φ<span class="id" type="var">s</span> {<span class="id" type="var">A</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.RelationClasses.html#Reflexive"><span class="id" type="class">Reflexive</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_arg"><span class="id" type="constructor">proper_partial_arg</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <a name="proper_partial_arg_default"><span class="id" type="instance">proper_partial_arg_default</span></a> φ<span class="id" type="var">s</span> {<span class="id" type="var">A</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.RelDefinitions.html#NotEvar"><span class="id" type="class">NotEvar</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_arg"><span class="id" type="constructor">proper_partial_arg</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
The <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a></span> processing phase consists in using
  <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_applies"><span class="id" type="projection">proper_applies</span></a></span> an arbitrary number of times. TODO: we may want to
  use the <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.Morphisms.html#Params"><span class="id" type="class">Params</span></a></span> class to limit the resulting search space to only
  one possibility instead. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Global Instance</span> <a name="proper_partial_app_bail"><span class="id" type="instance">proper_partial_app_bail</span></a> φ<span class="id" type="var">s</span> {<span class="id" type="var">A</span>} (<span class="id" type="var">R</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">tauto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <a name="proper_partial_app_arg"><span class="id" type="lemma">proper_partial_app_arg</span></a> φ<span class="id" type="var">s</span> {<span class="id" type="var">A</span>} (<span class="id" type="var">B</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> → <span class="id" type="keyword">Type</span>) <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">R'</span> <span class="id" type="var">m</span>:<br/>
&nbsp;&nbsp;@<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) (<span class="id" type="keyword">∀</span> <span class="id" type="var">a</span>, <a class="idref" href="coqrel.MorphismsCompat.html#B"><span class="id" type="variable">B</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#a"><span class="id" type="variable">a</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperApplies"><span class="id" type="class">ProperApplies</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#B"><span class="id" type="variable">B</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R"><span class="id" type="variable">R</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#a"><span class="id" type="variable">a</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R'"><span class="id" type="variable">R'</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> →<br/>
&nbsp;&nbsp;@<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) (<a class="idref" href="coqrel.MorphismsCompat.html#B"><span class="id" type="variable">B</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#a"><span class="id" type="variable">a</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R'"><span class="id" type="variable">R'</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#a"><span class="id" type="variable">a</span></a>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
When using <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app_arg"><span class="id" type="lemma">proper_partial_app_arg</span></a></span>, the unification of the goal
  against the subterm <span class="inlinecode">(<a class="idref" href="coqrel.LogicalRelationsTests.html#B"><span class="id" type="variable">B</span></a></span> <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#a"><span class="id" type="variable">a</span></a>)</span> is problematic, because usually the type
  will be an arbitrary expression where <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#a"><span class="id" type="variable">a</span></a></span> appears freely. Therefore,
  we first need to put the goal in the right form. The tactic
  <span class="inlinecode"><span class="id" type="var">dependent_type_of</span></span> recovers the type of a term that can be applied,
  as a function of its first argument. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">dependent_type_of</span> <span class="id" type="var">f</span> <span class="id" type="var">arg</span> <span class="id" type="var">T</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">A</span> := <span class="id" type="var">type</span> <span class="id" type="var">of</span> <span class="id" type="var">arg</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">x</span> := <span class="id" type="tactic">fresh</span> "x" <span class="id" type="keyword">in</span> <span class="id" type="tactic">evar</span> (<span class="id" type="var">x</span> : <span class="id" type="var">A</span>);<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">fx</span> := <span class="id" type="tactic">fresh</span> "fx" <span class="id" type="keyword">in</span> <span class="id" type="tactic">set</span> (<span class="id" type="var">fx</span> := <span class="id" type="var">f</span> <span class="id" type="var">x</span>);<br/>
&nbsp;&nbsp;<span class="id" type="tactic">pattern</span> <span class="id" type="var">x</span> <span class="id" type="keyword">in</span> <span class="id" type="var">fx</span>;<br/>
&nbsp;&nbsp;<span class="id" type="var">lazymatch</span> <span class="id" type="var">type</span> <span class="id" type="var">of</span> <span class="id" type="var">fx</span> <span class="id" type="keyword">with</span> ?<span class="id" type="var">TT</span> <span class="id" type="var">_</span> ⇒ <span class="id" type="tactic">set</span> (<span class="id" type="var">T</span> := <span class="id" type="var">TT</span>) <span class="id" type="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">y</span> := <span class="id" type="tactic">eval</span> <span class="id" type="tactic">red</span> <span class="id" type="keyword">in</span> <span class="id" type="var">x</span> <span class="id" type="keyword">in</span> <span class="id" type="var">unify</span> <span class="id" type="var">y</span> <span class="id" type="var">arg</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">subst</span> <span class="id" type="var">x</span> <span class="id" type="var">fx</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">proper_partial_app_arg</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">lazymatch</span> <span class="id" type="keyword">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::?</span></a>φ<span class="id" type="var">s</span>) ?<span class="id" type="var">R</span> (?<span class="id" type="var">op</span> ?<span class="id" type="var">arg</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">T</span> := <span class="id" type="tactic">fresh</span> "T" <span class="id" type="keyword">in</span> <span class="id" type="var">dependent_type_of</span> <span class="id" type="var">op</span> <span class="id" type="var">arg</span> <span class="id" type="var">T</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app_arg"><span class="id" type="lemma">proper_partial_app_arg</span></a> φ<span class="id" type="var">s</span> <span class="id" type="var">T</span> <span class="id" type="var">_</span> <span class="id" type="var">arg</span> <span class="id" type="var">R</span> <span class="id" type="var">op</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span> <span class="id" type="var">T</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Hint Extern</span> 2 (<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><span class="id" type="var">_</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" type="var">proper_partial_app_arg</span> : <span class="id" type="var">typeclass_instances</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab19"></a><h2 class="section">Using <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" type="record">subrel</span></a></span></h2>

<div class="paragraph"> </div>

 The processing step <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_subrel"><span class="id" type="constructor">proper_subrel</span></a></span> causes the search to be
  extended to subrelations. The order of the <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="record">ProperQuery</span></a></span> and
  <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" type="record">subrel</span></a></span> arguments is pretty critical: first, we go on and try to
  find /any/ instance of <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> for <span class="inlinecode"><a class="idref" href="coqrel.LogicalRelationsTests.html#m"><span class="id" type="variable">m</span></a></span>; then, we check to see if
  the associated relation is a subrelation of the target one. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Global Instance</span> <a name="do_proper_subrel"><span class="id" type="instance">do_proper_subrel</span></a> {<span class="id" type="var">A</span>} φ<span class="id" type="var">s</span> (<span class="id" type="var">R1</span> <span class="id" type="var">R2</span>: <a class="idref" href="coqrel.RelDefinitions.html#rel"><span class="id" type="abbreviation">rel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>) (<span class="id" type="var">m</span>: <a class="idref" href="coqrel.MorphismsCompat.html#A"><span class="id" type="variable">A</span></a>):<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R1"><span class="id" type="variable">R1</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a> →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.Delay.html#NonDelayed"><span class="id" type="class">NonDelayed</span></a> (<a class="idref" href="coqrel.RelDefinitions.html#RAuto"><span class="id" type="class">RAuto</span></a> (<a class="idref" href="coqrel.RelDefinitions.html#subrel"><span class="id" type="class">subrel</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R1"><span class="id" type="variable">R1</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#R2"><span class="id" type="variable">R2</span></a>)) →<br/>
&nbsp;&nbsp;<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> (<a class="idref" href="coqrel.MorphismsCompat.html#proper_subrel"><span class="id" type="constructor">proper_subrel</span></a><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">φ</span></a><a class="idref" href="coqrel.MorphismsCompat.html#φs"><span class="id" type="variable">s</span></a>) <a class="idref" href="coqrel.MorphismsCompat.html#R2"><span class="id" type="variable">R2</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#m"><span class="id" type="variable">m</span></a>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">firstorder</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab20"></a><h2 class="section">Compatibility with setoid rewriting</h2>

<div class="paragraph"> </div>

 So far our system is isolated from the similar constructions in
  <span class="inlinecode"><span class="id" type="library">Coq.Classes.Morphisms</span></span>. The <span class="inlinecode"><span class="id" type="var">convert_proper</span></span> tactic permits a
  controlled interaction between them. It converts a <span class="inlinecode"><span class="id" type="var">Morphisms.Proper</span></span>
  goal into a <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="record">ProperQuery</span></a></span> one, replacing legacy relators such as
  <span class="inlinecode"><a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.Morphisms.html#respectful"><span class="id" type="definition">respectful</span></a></span> with their more general counterparts defined here.
  This allows the setoid rewriting mechanism to use the morphisms we
  define.

<div class="paragraph"> </div>

  Note that in the query we use, <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_subrel"><span class="id" type="constructor">proper_subrel</span></a></span> needs to happen
  before <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a></span>, otherwise <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app_arg"><span class="id" type="lemma">proper_partial_app_arg</span></a></span>
  might replace the target relation with an existential variable,
  breaking the subrelation search. Possibly, another solution would be
  to change the order of arguments in <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app_arg"><span class="id" type="lemma">proper_partial_app_arg</span></a></span> so that
  the <span class="inlinecode"><a class="idref" href="coqrel.MorphismsCompat.html#ProperApplies"><span class="id" type="record">ProperApplies</span></a></span> subgoal is solved first. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Notation</span> <a name="rewrite_proper_query"><span class="id" type="abbreviation">rewrite_proper_query</span></a> :=<br/>
&nbsp;&nbsp;(<a class="idref" href="coqrel.MorphismsCompat.html#proper_orientation"><span class="id" type="constructor">proper_orientation</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#proper_subrel"><span class="id" type="constructor">proper_subrel</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#proper_partial_app"><span class="id" type="constructor">proper_partial_app</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#:list_scope:x_'::'_x"><span class="id" type="notation">::</span></a> <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Init.Datatypes.html#nil"><span class="id" type="constructor">nil</span></a>)<br/>
&nbsp;&nbsp;(<span class="id" type="var">only</span> <span class="id" type="var">parsing</span>).<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">convert_proper</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="keyword">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">appcontext</span> <span class="id" type="var">C</span>[<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.Morphisms.html#respectful"><span class="id" type="definition">respectful</span></a> ?<span class="id" type="var">R1</span> ?<span class="id" type="var">R2</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">T'</span> := <span class="id" type="keyword">context</span> <span class="id" type="var">C</span>[<span class="id" type="var">R1</span> <a class="idref" href="coqrel.RelDefinitions.html#:rel_scope:x_'==>'_x"><span class="id" type="notation">==&gt;</span></a> <span class="id" type="var">R2</span>] <span class="id" type="keyword">in</span> <span class="id" type="tactic">change</span> <span class="id" type="var">T'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">appcontext</span> <span class="id" type="var">C</span>[<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.Morphisms.html#forall_relation"><span class="id" type="definition">forall_relation</span></a> ?<span class="id" type="var">R</span>] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">T'</span> := <span class="id" type="keyword">context</span> <span class="id" type="var">C</span>[<a class="idref" href="coqrel.Relators.html#::'forallr'_'-'_','_x"><span class="id" type="notation">forallr</span></a> <a class="idref" href="coqrel.Relators.html#::'forallr'_'-'_','_x"><span class="id" type="notation">-,</span></a> <span class="id" type="var">R</span>] <span class="id" type="keyword">in</span> <span class="id" type="tactic">change</span> <span class="id" type="var">T'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| |- <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.Morphisms.html#Proper"><span class="id" type="class">Morphisms.Proper</span></a> ?<span class="id" type="var">R</span> ?<span class="id" type="var">m</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">change</span> (<a class="idref" href="coqrel.MorphismsCompat.html#ProperQuery"><span class="id" type="class">ProperQuery</span></a> <a class="idref" href="coqrel.MorphismsCompat.html#rewrite_proper_query"><span class="id" type="abbreviation">rewrite_proper_query</span></a> <span class="id" type="var">R</span> <span class="id" type="var">m</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
We want <span class="inlinecode"><span class="id" type="var">convert_proper</span></span> to be used for the initial <span class="inlinecode"><a class="idref" href="coqrel.RelDefinitions.html#Proper"><span class="id" type="abbreviation">Proper</span></a></span> goal,
  but we're not really interested in having it applied to the subgoals
  generated by the original process in <span class="inlinecode"><span class="id" type="library">Coq.Classes.Morphisms</span></span>, since
  we have our own. The following tactic attempts to detect and reject
  cases where some work has already been done. 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">use_convert_proper</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="keyword">goal</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.Morphisms.html#normalization_done"><span class="id" type="inductive">normalization_done</span></a> |- <span class="id" type="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">fail</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">H</span> : <a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.Morphisms.html#apply_subrelation"><span class="id" type="inductive">apply_subrelation</span></a> |- <span class="id" type="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">progress</span> <span class="id" type="var">convert_proper</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Hint Extern</span> 1 (<a class="idref" href="http://coq.inria.fr/distrib/8.4pl4/stdlib/Coq.Classes.Morphisms.html#Proper"><span class="id" type="class">Morphisms.Proper</span></a> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) ⇒<br/>
&nbsp;&nbsp;<span class="id" type="var">use_convert_proper</span> : <span class="id" type="var">typeclass_instances</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>